## 快速定位最大值最小值

为什么有这个需求？

因为上周查看一只股票最近几年的行情数据，需要查看近几年市值最低点在什么时候出现，最低市值是多少？市值最高点在什么时候出现，最高的市值又是多少？

我在行情图上又拖又拉，一会儿放大一会儿缩小，还挺麻烦的。其实呢，这个事情在pandas里面很容易搞定。

首先我们必须要获取到这些行情数据，然后用pandas来读取它。谢天谢地，在量化平台上很容易拿到一只股票的行情数据。

假设，我现在已经将这只股票的数据保存到了pandas中的DataFrame对象里面，我把它打出来：

```
#执行print(df)的输出

                   code  pe_ratio  pb_ratio  market_cap
day                                                    
2016-03-01  002027.XSHE   34.5035   25.4271   1169.3248
2016-03-02  002027.XSHE   36.0459   26.5638   1221.5966
2016-03-03  002027.XSHE   35.7059   26.3132   1210.0721
2016-03-04  002027.XSHE   36.1309   26.6264   1224.4777
2016-03-07  002027.XSHE   37.1025   27.3424   1257.4049
2016-03-08  002027.XSHE   36.7139   27.0560   1244.2340
2016-03-09  002027.XSHE   35.0986   25.8657   1189.4926
2016-03-10  002027.XSHE   33.8113   24.9170   1145.8643
2016-03-11  002027.XSHE   33.3741   24.5948   1131.0470
2016-03-14  002027.XSHE   35.1351   25.8925   1190.7274
...                 ...       ...       ...         ...
2022-08-22  002027.XSHE   18.6285    4.2919    850.6456
2022-08-23  002027.XSHE   18.3122    4.2190    836.2034
2022-08-24  002027.XSHE   18.2489    4.2045    833.3149
2022-08-25  002027.XSHE   18.8499    4.3429    860.7551
2022-08-26  002027.XSHE   18.7866    4.3283    857.8667
2022-08-29  002027.XSHE   18.6917    4.3065    853.5340
2022-08-30  002027.XSHE   18.5020    4.2628    844.8687
2022-08-31  002027.XSHE   19.1661    4.4158    875.1973
2022-09-01  002027.XSHE   18.5968    4.2846    849.2013
2022-09-02  002027.XSHE   18.5336    4.2700    846.3129

[1588 rows x 4 columns]
```

便得到了从2016年3月1日~2022年9月2日的pe_ratio（市盈率）、pb_ratio（市净率）和market_cap（市值）这几项数据。

我们可以首先使用`describe()`函数打印出该DataFrame最基本的统计信息：

```
# 执行df.describe()的输出

          pe_ratio     pb_ratio   market_cap
count  1588.000000  1588.000000  1588.000000
mean     29.275348    11.124686  1153.913727
std      13.291802     6.182639   290.671698
min      10.681900     4.101400   572.437300
25%      18.052300     6.291150   891.049600
50%      25.270300     8.220200  1124.203350
75%      36.081725    15.543475  1388.894425
max      73.131400    31.450500  1889.043200
```

可以看到，这些基本的统计信息里已经每列的基本统计信息，比如有多少项、中值是多少、标准差多少、也有最大值和最小值的信息。

但是，从中我无法得知最大值和最小值具体在哪一行，也就是在哪一天出现呢？

这重要吗？当然重要了，因为我写笔记的时候需要更具体的数据，不仅要说出最近几年的最高市值、最低市值，还需要说明是在哪一天出现的。这样才显得专业（专业强迫症...）

![](./how-to.jpg)

会不会有一筹莫展的感觉？


莫慌，实际上pandas早就为我们准备好了，那就是`idxmax()`和`idxmin`这两个函数。

先看这两个函数的释义：

- [pandas.DataFrame.idxmax](https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.idxmax.html)

> Return index of first occurrence of maximum over requested axis.

- [pandas.DataFrame.idxmin](https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.idxmin.html)

> Return index of first occurrence of minimum over requested axis.

它们的意思是返回最大值、最小值的索引。所以，有了这个函数我们就能够这样使用拉：

```
# 先获取最大值和最小值的索引，分别保存为idxmax和idxmin
idxmax = df['market_cap'].idxmax()
idxmin = df['market_cap'].idxmin()

# idxmax和idxmin对应了行索引，再打印出这两行即可
print(df.loc[[idxmax, idxmin]])

                   code  pe_ratio  pb_ratio  market_cap
day                                                    
2021-02-18  002027.XSHE   69.5185   12.4466   1889.0432
2020-04-13  002027.XSHE   30.5300    4.1544    572.4373
```

你看，我们就得到了，002027这支股票在2021年2月18日达到了自2016年3月以来的最高市值，为1889.04亿；在2020年4月13日跌到2016年3月以来的最低位，市值位572.43亿。是不是和上面的统计信息里面完全匹配呀。

技能get!

全文完。喜欢就点个赞吧^^
