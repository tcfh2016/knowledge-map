## 第22章 开发者测试

测试是最常见的改善质量的活动，常见的包括单元测试、组件测试、集成测试、回归测试、系统测试，本章的“测试”指的是由开发人员进行的测试，通常包括前面三种。测试通常可分为“黑盒测试”和“白盒测试”，前者测试者无法了解测试对象内部工作机制，后者测试者清楚待测试对象内部工作机制。

“测试”和“调试”是两种不同的活动，测试是一种检查错误的方法，而调试意味着错误已经被发现，要做的是诊断错误并消灭造成这些错误的根本原因。

### 22.1 开发者测试在软件质量中的角色

测试在任何软件质量规划中都是一个重要的组成部分，根据项目大小和复杂程度的不同，开发者测试应该占整个项目时间的8%~25%。如前面一章谈到的，各种形式的协同开发实践都表现出比测试更高的错误检测率，而且成本不到测试的二分之一。然而，测试的部分问题在于它通常没有发挥应有的效率。理解测试基本概念可以更好地支持测试，也能提升测试的效率。

怎样利用开发者测试的结果？最直接地，可以用这个结果来评估正在开发的产品的可靠性。测试结果的另一用途是可以用于指导对软件的修正。最后，测试发现的记录有助于你归纳出程序中最常见的错误类型，可以据此选择适当的培训课程、指导技术复查和设计测试用例。

### 22.2 开发者测试的推荐方法

采用系统化的开发者测试方法能最大限度提高你发现各种错误的能力，但要确保相关的需求、设计关注点进行了测试，并且使用一个记录在本项目迄今为止犯的所有错误类型的检查表。

测试先行的编程是很有用的软件开发实践，它可以将从引入缺陷到发现并排除缺陷的实践缩减至最短。首先编写测试用例，也会迫使你在开始写代码之前至少思考一下需求和设计，这往往会催生更高质量的代码。

开发者测试是有价值的，不过也具有局限性，比如开发人员往往做一些检验代码能否工作的测试，而不是做所有可能让代码失效的测试（成熟的测试机构倾向于让肮胀测试的数量是干净测试的5倍）。同时开发者测试对于覆盖率也有过于乐观的估计。所以仅仅进行开发者测试是不够的，还需要补充其他实践，包括独立测试技术和协同构建技术。

### 22.3 测试技巧锦囊

进行完全测试是不可能的，因此测试的窍门在于选择那些最有可能找到错误的测试用例。当你规划测试的时候，要去除那些不会告诉你任何新情况的测试用例。

- 结构化的基础测试：通过计算圈复杂度来确定最低的测试用例数量，保证路径覆盖。
- 数据流测试：对所有可能的“定义-使用”路径进行测试。
- 等价划分：如果两个用例能揭示的错误完全相同，那么只要一个就够了。
- 猜测错误：猜测程序会在哪里出错的基础上建立测试用例。
- 边界值分析：写一些用例来测试边界值条件。
- 几类坏数据：猜测并测试几种类型的坏数据。
- 几类好数据：猜测并测试几种类型的好数据。

### 22.4 典型錯誤

我们很自然会有这样的假设：缺陷在代码里面是均匀分布的。但事实上这是错误的，绝大多数错误往往与少数几个具有严重缺陷的子程序有关。维护工作应该围绕如何确定容易出问题的子程序，如何把这些部分推到重来，重新设计并编写代码。

对错误进行分类不是结论性的，因为不同的组织拥有对错误类型不同的研究结果。将错误归结于不同的开发活动的多数数据也不是结论性的，但有一点可以确定的是构建总会出现大量的错误。因此使用高质量的开发技术会有更少的错误，维护的成本也更低。

### 22.5 测试支持工具

- 为测试各个类构造脚手架：dummy class - mock object/stub object
- diff工具
- 测试数据生成器
- 覆盖率监视器
- 日志记录器
- 符号调试器
- 系统干扰器
- 错误数据库

### 22.6 改善测试过程

有效测试的关键之一，就是在待测试项目开始之初就拟定测试计划。就重要性而言，测试应当与设计和编码平起平坐，这就要求项目为测试分配时间，重视测试并保障该过程的质量。

### 22.7 保留测试记录

除了使测试过程有重复之处，还需要对整个项目进行量化评估，以确定所作的修改是使程序质量有所提高还是降低。
