## 第24章 重构

软件项目在初始开发阶段，代码会有实质性的进化。在初始的代码编写过程中，就会出现很多剧烈的改变，如同在代码维护阶段可以看到的那样。典型的项目花在编码、调试和单元测试上的时间会占到整个项目的30%到65%不等。另一个事实是现在的开发方法增强了代码在构造阶段中改变的潜力。在旧式的软件生命周期中，项目成功与否的关键在于能否避免代码的改变。越来越多的现代开发方法已经放弃了对代码的前瞻性。如今的开发方法更多地以代码为中心。在整个项目生命周期中代码都会不断地演化。

### 24.1 软件演化的类型

区分软件演化类型的关键，就是程序的质量在这一过程中是提高了还是降低了。第二个标准是这样的演化是源于程序构建过程中的修改，还是维护过程中的修改。

程序员在参与到软件演化时有一个普遍的弱点，这就是将其作为一种并非有意而为的过程。如果你能在开发过程中认识到软件演化是无法避免且具有重要意义的现象，并对其细加谋划，就可能使这一过程有益于你的开发。软件演化的基本准则就是演化应当提升程序的内在质量。

### 24.2 重构简介

要实现软件演化基本准则，最关键的策略就是重构。Martin Fowler将其定义为“在不改变软件外部行为的前提下，对其内部结构进行改变，使之更容易理解并便于修改”。

有时，代码在维护过程中质量会降低，而有时代码在最初诞生的时候就先天不良。无论是哪种情况，都会有一些警告信号，这些信号有时称为“臭味（smells）”——这些信号标志着程序需要重构。

### 24.3 特定的重构

本部分列出一份总结自《Refactoring》的重构目录，它们重点关注自己认为最为有用的重构方法。

- 数据级的重构
- 语句级的重构
- 子程序级重构
- 类实现的重构
- 类接口的成狗
- 系统级重构

### 24.4 安全的重构

重构是一种改善代码质量的强有力的技术。但正如所有功能强大的工具一样，如果使用不当重构给你带来的麻烦会比它所带来的好处还要多。

### 24.5 重构策略

对任何特定程序都能带来好处的重构方法本应是无穷无尽的。和其他的编程行为一样，重构同样受制于收益递减定律，也符合80/20法则。在斟酌哪种重构方法最为重要的时候需要考虑一些建议。
